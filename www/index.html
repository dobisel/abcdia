<!doctype html>
<html>

<head>
<meta charset="utf-8">
<script type="text/javascript" src="brython.js"></script>
<script type="text/javascript" src="stdlib.js"></script>
<script type="text/javascript" src="dial.js"></script>
<style>
  font-family: monospace;
</style>
</head>

<body onload="brython({debug: 1})">

<a href="/check.html">Jump to tests</a>
<br />

<textarea cols="100%" rows="8" id="error"></textarea>
<br />
<textarea cols="55" rows="40" id="source">
diagram: diaL demo
version: 1.0
author: pylover

sequence:

@foo: Start
foo -> bar: hello() -> HI
  bar -> baz: hey() -> Hey

@foo: End
</textarea>
<textarea cols="120" rows="40" id="target"></textarea>

<script type="text/python">
from browser import window, document, bind

from dial import Diagram, InterpreterError

source = document['source']
target = document['target']
error = document['error']
processing = False


def update(e):
  global processing
  if processing:
    return

  if hasattr(e, 'charCode') and e.charCode != 13:
    return 

  processing = True
  print('processing')
  try:
    error.value = ''
    v = source.value
    d = Diagram(v)
    target.value = d.renders()
  except InterpreterError as ex:
    error.value = str(ex)
    print('error')
  finally:
    processing = False


source.bind('keypress', update)
source.bind('change', update)
update(None)

# pythonpath: ['public']
</script>
</body>

</html>
