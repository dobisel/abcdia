from dial import Diagram

from .helpers import eqdia


def test_sequence_condition():
    d = Diagram('''
        diagram: Foo
        version: 1.0
        sequence:

        if: Yes
          f -> b
        if: Ok
          b -> c
            c -> d
              d -> c
        else:
          b -> e
        else:
          b -> d

    ''')
    assert eqdia(d.renders(), '''
    .................................
    . DIAGRAM: Foo                  .
    . version: 1.0                  .
    .                               .
    . +---+ +---+ +---+ +---+ +---+ .
    . | f | | b | | c | | d | | e | .
    . +---+ +---+ +---+ +---+ +---+ .
    .   |     |     |     |     |   .
    . ***********   |     |     |   .
    . * if Yes  *   |     |     |   .
    . ***********   |     |     |   .
    .   |     |     |     |     |   .
    .   |~~~~>|     |     |     |   .
    .   |     |     |     |     |   .
    .   |<----|     |     |     |   .
    .   |     |     |     |     |   .
    . ***********   |     |     |   .
    . * end if  *   |     |     |   .
    . ***********   |     |     |   .
    .   |     |     |     |     |   .
    .   |   *********************** .
    .   |   * if Ok               * .
    .   |   *********************** .
    .   |     |     |     |     |   .
    .   |     |~~~~>|     |     |   .
    .   |     |     |~~~~>|     |   .
    .   |     |     |     |     |   .
    .   |     |     |<~~~~|     |   .
    .   |     |     |     |     |   .
    .   |     |     |---->|     |   .
    .   |     |     |     |     |   .
    .   |     |     |<----|     |   .
    .   |     |<----|     |     |   .
    .   |     |     |     |     |   .
    .   |   *********************** .
    .   |   * else                * .
    .   |   *********************** .
    .   |     |     |     |     |   .
    .   |     |~~~~~~~~~~~~~~~~>|   .
    .   |     |     |     |     |   .
    .   |     |<----------------|   .
    .   |     |     |     |     |   .
    .   |   *********************** .
    .   |   * else                * .
    .   |   *********************** .
    .   |     |     |     |     |   .
    .   |     |~~~~~~~~~~>|     |   .
    .   |     |     |     |     |   .
    .   |     |<----------|     |   .
    .   |     |     |     |     |   .
    .   |   *********************** .
    .   |   * end if              * .
    .   |   *********************** .
    .   |     |     |     |     |   .
    . +---+ +---+ +---+ +---+ +---+ .
    . | f | | b | | c | | d | | e | .
    . +---+ +---+ +---+ +---+ +---+ .
    .                               .
    .................................
    ''')


def test_sequence_conditiontext():
    d = Diagram('''
        diagram: Foo
        version: 1.0
        sequence:

        s -> f
        if: 01234
          f -> b
        elif: 4545
          f -> c
            c -> s
        else: foo bar baz qux
          c -> b: foo bar
    ''')
    assert eqdia(d.renders(), '''
    ...................................
    . DIAGRAM: Foo                    .
    . version: 1.0                    .
    .                                 .
    . +---+ +---+  +---+        +---+ .
    . | s | | f |  | b |        | c | .
    . +---+ +---+  +---+        +---+ .
    .   |     |      |            |   .
    .   |~~~~>|      |            |   .
    .   |     |      |            |   .
    .   |<----|      |            |   .
    .   |     |      |            |   .
    . ******************************* .
    . * if 01234                    * .
    . ******************************* .
    .   |     |      |            |   .
    .   |     |~~~~~>|            |   .
    .   |     |      |            |   .
    .   |     |<-----|            |   .
    .   |     |      |            |   .
    . ******************************* .
    . * elif 4545                   * .
    . ******************************* .
    .   |     |      |            |   .
    .   |     |~~~~~~~~~~~~~~~~~~>|   .
    .   |     |      |            |   .
    .   |<~~~~~~~~~~~~~~~~~~~~~~~~|   .
    .   |     |      |            |   .
    .   |------------------------>|   .
    .   |     |      |            |   .
    .   |     |<------------------|   .
    .   |     |      |            |   .
    . ******************************* .
    . * else foo bar baz qux        * .
    . ******************************* .
    .   |     |      |            |   .
    .   |     |      |<~~foo bar~~|   .
    .   |     |      |            |   .
    .   |     |      |----------->|   .
    .   |     |      |            |   .
    . ******************************* .
    . * end if                      * .
    . ******************************* .
    .   |     |      |            |   .
    . +---+ +---+  +---+        +---+ .
    . | s | | f |  | b |        | c | .
    . +---+ +---+  +---+        +---+ .
    .                                 .
    ...................................
    ''')


def test_sequence_emptyif():
    d = Diagram('''
        diagram: Foo
        version: 1.0
        sequence:

        if
    ''')
    assert eqdia(d.renders(), '''
    ................
    . DIAGRAM: Foo .
    . version: 1.0 .
    .              .
    . **********   .
    . * if     *   .
    . **********   .
    . **********   .
    . * end if *   .
    . **********   .
    .              .
    ................
    ''')

    d = Diagram('''
        diagram: Foo
        version: 1.0
        sequence:

        if
        else
    ''')
    assert eqdia(d.renders(), '''
    ................
    . DIAGRAM: Foo .
    . version: 1.0 .
    .              .
    . **********   .
    . * if     *   .
    . **********   .
    . **********   .
    . * else   *   .
    . **********   .
    . **********   .
    . * end if *   .
    . **********   .
    .              .
    ................
    ''')


def test_sequence_condition_on_reversecall():
    d = Diagram('''
        diagram: Foo
        version: 1.0
        sequence:

        a -> b
          b -> c
        if
          b -> a
    ''')
    assert eqdia(d.renders(), '''
    .....................
    . DIAGRAM: Foo      .
    . version: 1.0      .
    .                   .
    . +---+ +---+ +---+ .
    . | a | | b | | c | .
    . +---+ +---+ +---+ .
    .   |     |     |   .
    .   |~~~~>|     |   .
    .   |     |~~~~>|   .
    .   |     |     |   .
    .   |     |<----|   .
    .   |<----|     |   .
    .   |     |     |   .
    . ***********   |   .
    . * if      *   |   .
    . ***********   |   .
    .   |     |     |   .
    .   |<~~~~|     |   .
    .   |     |     |   .
    .   |---->|     |   .
    .   |     |     |   .
    . ***********   |   .
    . * end if  *   |   .
    . ***********   |   .
    .   |     |     |   .
    . +---+ +---+ +---+ .
    . | a | | b | | c | .
    . +---+ +---+ +---+ .
    .                   .
    .....................
    ''')
