from adia import Diagram

from .helpers import eqdia


def test_sequence_condition():
    d = Diagram('''
        sequence:

        if: Yes
          f -> b
        if: Ok
          b -> c
            c -> d
              d -> c
        else:
          b -> e
        else:
          b -> d

    ''')
    assert eqdia(d, '''
    .................................
    . +---+ +---+ +---+ +---+ +---+ .
    . | f | | b | | c | | d | | e | .
    . +---+ +---+ +---+ +---+ +---+ .
    .   |     |     |     |     |   .
    . ***********   |     |     |   .
    . * if Yes  *   |     |     |   .
    . ***********   |     |     |   .
    .   |     |     |     |     |   .
    .   |~~~~>|     |     |     |   .
    .   |     |     |     |     |   .
    .   |<----|     |     |     |   .
    .   |     |     |     |     |   .
    . ***********   |     |     |   .
    . * end if  *   |     |     |   .
    . ***********   |     |     |   .
    .   |     |     |     |     |   .
    .   |   *********************** .
    .   |   * if Ok               * .
    .   |   *********************** .
    .   |     |     |     |     |   .
    .   |     |~~~~>|     |     |   .
    .   |     |     |~~~~>|     |   .
    .   |     |     |     |     |   .
    .   |     |     |<~~~~|     |   .
    .   |     |     |     |     |   .
    .   |     |     |---->|     |   .
    .   |     |     |     |     |   .
    .   |     |     |<----|     |   .
    .   |     |<----|     |     |   .
    .   |     |     |     |     |   .
    .   |   *********************** .
    .   |   * else                * .
    .   |   *********************** .
    .   |     |     |     |     |   .
    .   |     |~~~~~~~~~~~~~~~~>|   .
    .   |     |     |     |     |   .
    .   |     |<----------------|   .
    .   |     |     |     |     |   .
    .   |   *********************** .
    .   |   * else                * .
    .   |   *********************** .
    .   |     |     |     |     |   .
    .   |     |~~~~~~~~~~>|     |   .
    .   |     |     |     |     |   .
    .   |     |<----------|     |   .
    .   |     |     |     |     |   .
    .   |   *********************** .
    .   |   * end if              * .
    .   |   *********************** .
    .   |     |     |     |     |   .
    . +---+ +---+ +---+ +---+ +---+ .
    . | f | | b | | c | | d | | e | .
    . +---+ +---+ +---+ +---+ +---+ .
    .................................
    ''')


def test_sequence_conditiontext():
    d = Diagram('''
        sequence:

        s -> f
        if: 01234
          f -> b
        elif: 4545
          f -> c
            c -> s
        else: foo bar baz qux
          c -> b: foo bar
    ''')
    assert eqdia(d, '''
    ...................................
    . +---+ +---+  +---+        +---+ .
    . | s | | f |  | b |        | c | .
    . +---+ +---+  +---+        +---+ .
    .   |     |      |            |   .
    .   |~~~~>|      |            |   .
    .   |     |      |            |   .
    .   |<----|      |            |   .
    .   |     |      |            |   .
    . ******************************* .
    . * if 01234                    * .
    . ******************************* .
    .   |     |      |            |   .
    .   |     |~~~~~>|            |   .
    .   |     |      |            |   .
    .   |     |<-----|            |   .
    .   |     |      |            |   .
    . ******************************* .
    . * elif 4545                   * .
    . ******************************* .
    .   |     |      |            |   .
    .   |     |~~~~~~~~~~~~~~~~~~>|   .
    .   |     |      |            |   .
    .   |<~~~~~~~~~~~~~~~~~~~~~~~~|   .
    .   |     |      |            |   .
    .   |------------------------>|   .
    .   |     |      |            |   .
    .   |     |<------------------|   .
    .   |     |      |            |   .
    . ******************************* .
    . * else foo bar baz qux        * .
    . ******************************* .
    .   |     |      |            |   .
    .   |     |      |<~~foo bar~~|   .
    .   |     |      |            |   .
    .   |     |      |----------->|   .
    .   |     |      |            |   .
    . ******************************* .
    . * end if                      * .
    . ******************************* .
    .   |     |      |            |   .
    . +---+ +---+  +---+        +---+ .
    . | s | | f |  | b |        | c | .
    . +---+ +---+  +---+        +---+ .
    ...................................
    ''')


def test_sequence_emptyif():
    d = Diagram('''
        sequence:

        if
    ''')
    assert eqdia(d, '''
    ..............
    .            .
    . ********** .
    . * if     * .
    . ********** .
    . ********** .
    . * end if * .
    . ********** .
    ..............
    ''')

    d = Diagram('''
        sequence:

        if
        else
    ''')
    assert eqdia(d, '''
    ..............
    .            .
    . ********** .
    . * if     * .
    . ********** .
    . ********** .
    . * else   * .
    . ********** .
    . ********** .
    . * end if * .
    . ********** .
    ..............
    ''')

    d = Diagram('''
        sequence:

        if: foo > bar
        else
    ''')
    assert eqdia(d, '''
    ....................
    .                  .
    . **************** .
    . * if foo > bar * .
    . **************** .
    . **********       .
    . * else   *       .
    . **********       .
    . **********       .
    . * end if *       .
    . **********       .
    ....................
    ''')


def test_sequence_condition_on_reversecall():
    d = Diagram('''
        sequence:

        a -> b
          b -> c
        if
          b -> a
    ''')
    assert eqdia(d, '''
    .....................
    . +---+ +---+ +---+ .
    . | a | | b | | c | .
    . +---+ +---+ +---+ .
    .   |     |     |   .
    .   |~~~~>|     |   .
    .   |     |~~~~>|   .
    .   |     |     |   .
    .   |     |<----|   .
    .   |<----|     |   .
    .   |     |     |   .
    . ***********   |   .
    . * if      *   |   .
    . ***********   |   .
    .   |     |     |   .
    .   |<~~~~|     |   .
    .   |     |     |   .
    .   |---->|     |   .
    .   |     |     |   .
    . ***********   |   .
    . * end if  *   |   .
    . ***********   |   .
    .   |     |     |   .
    . +---+ +---+ +---+ .
    . | a | | b | | c | .
    . +---+ +---+ +---+ .
    .....................
    ''')
