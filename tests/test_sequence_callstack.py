from adia import Diagram

from .helpers import eqdia


def test_sequence_callstack():
    d = Diagram('''
        sequence:

        foo.title: Foo
        foo -> bar
          bar -> thud
            thud -> qux
              qux -> quux
        foo -> qux
        foo -> quux
          quux -> qux
    ''')
    assert eqdia(d, '''
    ...............................................
    . +-----+ +-----+ +-------+ +-----+ +-------+ .
    . | Foo | | bar | | thud  | | qux | | quux  | .
    . +-----+ +-----+ +-------+ +-----+ +-------+ .
    .    |       |        |        |        |     .
    .    |~~~~~~>|        |        |        |     .
    .    |       |~~~~~~~>|        |        |     .
    .    |       |        |~~~~~~~>|        |     .
    .    |       |        |        |~~~~~~~>|     .
    .    |       |        |        |        |     .
    .    |       |        |        |<-------|     .
    .    |       |        |<-------|        |     .
    .    |       |<-------|        |        |     .
    .    |<------|        |        |        |     .
    .    |       |        |        |        |     .
    .    |~~~~~~~~~~~~~~~~~~~~~~~~>|        |     .
    .    |       |        |        |        |     .
    .    |<------------------------|        |     .
    .    |       |        |        |        |     .
    .    |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~>|     .
    .    |       |        |        |        |     .
    .    |       |        |        |<~~~~~~~|     .
    .    |       |        |        |        |     .
    .    |       |        |        |------->|     .
    .    |       |        |        |        |     .
    .    |<---------------------------------|     .
    .    |       |        |        |        |     .
    . +-----+ +-----+ +-------+ +-----+ +-------+ .
    . | Foo | | bar | | thud  | | qux | | quux  | .
    . +-----+ +-----+ +-------+ +-----+ +-------+ .
    ...............................................
    ''')


def test_sequence_call_notext():
    d = Diagram('''
        sequence:
        f -> b
        foo -> bar
        foo -> b
        f -> bar
    ''')
    assert eqdia(d, '''
    ...............................
    . +---+ +---+ +-----+ +-----+ .
    . | f | | b | | foo | | bar | .
    . +---+ +---+ +-----+ +-----+ .
    .   |     |      |       |    .
    .   |~~~~>|      |       |    .
    .   |     |      |       |    .
    .   |<----|      |       |    .
    .   |     |      |       |    .
    .   |     |      |~~~~~~>|    .
    .   |     |      |       |    .
    .   |     |      |<------|    .
    .   |     |      |       |    .
    .   |     |<~~~~~|       |    .
    .   |     |      |       |    .
    .   |     |----->|       |    .
    .   |     |      |       |    .
    .   |~~~~~~~~~~~~~~~~~~~>|    .
    .   |     |      |       |    .
    .   |<-------------------|    .
    .   |     |      |       |    .
    . +---+ +---+ +-----+ +-----+ .
    . | f | | b | | foo | | bar | .
    . +---+ +---+ +-----+ +-----+ .
    ...............................
    ''')


def test_sequence_calltext_minimum():
    d = Diagram('''
        sequence:

        f -> b: 1
        foo -> bar: 2
        foo -> b: 3
        f -> bar: 4
    ''')
    assert eqdia(d, '''
    ..................................
    . +---+  +---+  +-----+  +-----+ .
    . | f |  | b |  | foo |  | bar | .
    . +---+  +---+  +-----+  +-----+ .
    .   |      |       |        |    .
    .   |~~~1~>|       |        |    .
    .   |      |       |        |    .
    .   |<-----|       |        |    .
    .   |      |       |        |    .
    .   |      |       |~~~2~~~>|    .
    .   |      |       |        |    .
    .   |      |       |<-------|    .
    .   |      |       |        |    .
    .   |      |<~~3~~~|        |    .
    .   |      |       |        |    .
    .   |      |------>|        |    .
    .   |      |       |        |    .
    .   |~~~4~~~~~~~~~~~~~~~~~~>|    .
    .   |      |       |        |    .
    .   |<----------------------|    .
    .   |      |       |        |    .
    . +---+  +---+  +-----+  +-----+ .
    . | f |  | b |  | foo |  | bar | .
    . +---+  +---+  +-----+  +-----+ .
    ..................................
    ''')


def test_sequence_calltext():

    d = Diagram('''
        sequence:

        @foo: Start
        foo -> bar: hello() => HI
          bar -> baz: hey() => Hey

        @foo: End
    ''')
    assert eqdia(d, '''
    .......................................
    . +-----+        +-----+      +-----+ .
    . | foo |        | bar |      | baz | .
    . +-----+        +-----+      +-----+ .
    .    |              |            |    .
    . ---------         |            |    .
    . | Start |         |            |    .
    . ---------         |            |    .
    .    |              |            |    .
    .    |~~~hello()~~~>|            |    .
    .    |              |~~~hey()~~~>|    .
    .    |              |            |    .
    .    |              |<--Hey------|    .
    .    |<--HI---------|            |    .
    .    |              |            |    .
    . -------           |            |    .
    . | End |           |            |    .
    . -------           |            |    .
    .    |              |            |    .
    . +-----+        +-----+      +-----+ .
    . | foo |        | bar |      | baz | .
    . +-----+        +-----+      +-----+ .
    .......................................
    ''')

    d = Diagram('''
        sequence:

        f -> b: init()
        foo -> bar: init()
        foo -> b: init()
        f -> bar: 010101010101010101010101010101010101
    ''')
    assert eqdia(d, '''
    ......................................................
    . +---+            +---+       +-----+       +-----+ .
    . | f |            | b |       | foo |       | bar | .
    . +---+            +---+       +-----+       +-----+ .
    .   |                |            |             |    .
    .   |~~~init()~~~~~~>|            |             |    .
    .   |                |            |             |    .
    .   |<---------------|            |             |    .
    .   |                |            |             |    .
    .   |                |            |~~~init()~~~>|    .
    .   |                |            |             |    .
    .   |                |            |<------------|    .
    .   |                |            |             |    .
    .   |                |<~~init()~~~|             |    .
    .   |                |            |             |    .
    .   |                |----------->|             |    .
    .   |                |            |             |    .
    .   |~~~010101010101010101010101010101010101~~~>|    .
    .   |                |            |             |    .
    .   |<------------------------------------------|    .
    .   |                |            |             |    .
    . +---+            +---+       +-----+       +-----+ .
    . | f |            | b |       | foo |       | bar | .
    . +---+            +---+       +-----+       +-----+ .
    ......................................................
    ''')


def test_sequence_callreturntext():
    d = Diagram('''
        sequence:

        f -> b: init() => int
        foo -> bar: init() => Object
        foo -> b: init()
        f -> bar: 0101 => 010101010101010101010101010101010101
    ''')
    assert eqdia(d, '''
    ......................................................
    . +---+            +---+       +-----+       +-----+ .
    . | f |            | b |       | foo |       | bar | .
    . +---+            +---+       +-----+       +-----+ .
    .   |                |            |             |    .
    .   |~~~init()~~~~~~>|            |             |    .
    .   |                |            |             |    .
    .   |<--int----------|            |             |    .
    .   |                |            |             |    .
    .   |                |            |~~~init()~~~>|    .
    .   |                |            |             |    .
    .   |                |            |<--Object----|    .
    .   |                |            |             |    .
    .   |                |<~~init()~~~|             |    .
    .   |                |            |             |    .
    .   |                |----------->|             |    .
    .   |                |            |             |    .
    .   |~~~0101~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~>|    .
    .   |                |            |             |    .
    .   |<--010101010101010101010101010101010101----|    .
    .   |                |            |             |    .
    . +---+            +---+       +-----+       +-----+ .
    . | f |            | b |       | foo |       | bar | .
    . +---+            +---+       +-----+       +-----+ .
    ......................................................
    ''')


def test_sequence_indentation_blankline_issue47():
    d = Diagram('''
        sequence:

        foo -> bar
          bar -> baz

            baz -> qux

    ''')
    assert eqdia(d, '''
    ...................................
    . +-----+ +-----+ +-----+ +-----+ .
    . | foo | | bar | | baz | | qux | .
    . +-----+ +-----+ +-----+ +-----+ .
    .    |       |       |       |    .
    .    |~~~~~~>|       |       |    .
    .    |       |~~~~~~>|       |    .
    .    |       |       |~~~~~~>|    .
    .    |       |       |       |    .
    .    |       |       |<------|    .
    .    |       |<------|       |    .
    .    |<------|       |       |    .
    .    |       |       |       |    .
    . +-----+ +-----+ +-----+ +-----+ .
    . | foo | | bar | | baz | | qux | .
    . +-----+ +-----+ +-----+ +-----+ .
    ...................................
    ''')
