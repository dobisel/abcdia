from dial.ascii import ASCIIDiagramRenderer
from dial.diagram import Diagram

from .helpers import eqdia


def test_asciisequence_header():
    r = ASCIIDiagramRenderer(Diagram('''
        diagram: Foo
        version: 1.0
        sequence: Bar
    '''))
    assert eqdia(str(r.render()), '''
    .................
    . DIAGRAM: Foo  .
    . version: 1.0  .
    .               .
    . SEQUENCE: Bar .
    .               .
    .................
    ''')

    r = ASCIIDiagramRenderer(Diagram('''
        diagram: Foo
        version: 1.0
        sequence:
    '''))
    assert eqdia(str(r.render()), '''
    ................
    . DIAGRAM: Foo .
    . version: 1.0 .
    .              .
    ................
    ''')


def test_asciisequence_callstack():
    r = ASCIIDiagramRenderer(Diagram('''
        diagram: Foo
        version: 1.0
        sequence:

        foo.title: Foo
        foo -> bar
          bar -> thud
            thud -> qux
              qux -> quux
        foo -> qux
        foo -> quux
          quux -> qux
    '''))
    assert eqdia(str(r.render()), '''
    ...............................................
    . DIAGRAM: Foo                                .
    . version: 1.0                                .
    .                                             .
    . +-----+ +-----+ +-------+ +-----+ +-------+ .
    . | Foo | | bar | | thud  | | qux | | quux  | .
    . +-----+ +-----+ +-------+ +-----+ +-------+ .
    .    |       |        |        |        |     .
    .    |~~~~~~>|        |        |        |     .
    .    |       |~~~~~~~>|        |        |     .
    .    |       |        |~~~~~~~>|        |     .
    .    |       |        |        |~~~~~~~>|     .
    .    |       |        |        |        |     .
    .    |       |        |        |<-------|     .
    .    |       |        |<-------|        |     .
    .    |       |<-------|        |        |     .
    .    |<------|        |        |        |     .
    .    |       |        |        |        |     .
    .    |~~~~~~~~~~~~~~~~~~~~~~~~>|        |     .
    .    |       |        |        |        |     .
    .    |<------------------------|        |     .
    .    |       |        |        |        |     .
    .    |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~>|     .
    .    |       |        |        |        |     .
    .    |       |        |        |<~~~~~~~|     .
    .    |       |        |        |        |     .
    .    |       |        |        |------->|     .
    .    |       |        |        |        |     .
    .    |<---------------------------------|     .
    .    |       |        |        |        |     .
    . +-----+ +-----+ +-------+ +-----+ +-------+ .
    . | Foo | | bar | | thud  | | qux | | quux  | .
    . +-----+ +-----+ +-------+ +-----+ +-------+ .
    .                                             .
    ...............................................
    ''')


# noqa
"""
    .....................................................................
    .                                                                   .
    . DIAGRAM: Foo                                                      .
    . author: alice                                                     .
    . version: 1.0                                                      .
    .                                                                   .
    . SEQUENCE: Title                                                   .
    .                                                                   .
    .      +-----+            +-------+               +-----+           .
    .      | foo |            | thud  |               | bar |           .
    .      +-----+            +-------+               +-----+           .
    .         |                   |                      |              .
    .    +----------------------------------------------------+         .
    .    | @foo ~ bar: |                                      |         .
    .    | Multiline note first line.                         |         .
    .    | Second line.                                       |         .
    .    +----------------------------------------------------+         .
    .         |                   |                      |              .
    .    +------------+           |                      |              .
    .    | @foo: note |           |                      |              .
    .    +------------+           |                      |              .
    .         |                   |                      |              .
    .         |              +--------------------------------+         .
    .         |              | @thud ~ bar: note              |         .
    .         |              +--------------------------------+         .
    .         |                   |                      |              .
    .    +---------------------------------------------------------+    .
    .    | if: thud is awake                                       |    .
    .    +---------------------------------------------------------+    .
    .    |    |                   |                      |         |    .
    .    |    |~~~~~~~~~~init()~~>|                      |         |    .
    .    |    |                   |                      |         |    .
    .    |    |              +--------------------------------+    |    .
    .    |    |              | for: i in range(5)             |    |    .
    .    |    |              +--------------------------------+    |    .
    .    |    |              |    |                      |    |    |    .
    .    |    |              |    |~~~~~~~~~~~~~fork()~~>|    |    |    .
    .    |    |              |    |                      |    |    |    .
    .    |    |              |    |<---------------------|    |    |    .
    .    |    |              |    |                      |    |    |    .
    .    |    |              +--------------------------------+    |    .
    .    |    |                   |                      |         |    .
    .    |    |                   |~~~~~~~~~~~~~init()~~>|         |    .
    .    |    |                   |                      |         |    .
    .    |    |                   |<---------------------|         |    .
    .    |    |<------------------|                      |         |    .
    .    |    |                   |                      |         |    .
    .    +---------------------------------------------------------+    .
    .    | else:                                                   |    .
    .    +---------------------------------------------------------+    .
    .    |    |                   |                      |         |    .
    .    |    |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~init()~~>|         |    .
    .    |    |                   |                      |         |    .
    .    |    |<-----------------------------------------|         |    .
    .    |    |                   |                      |         |    .
    .    +---------------------------------------------------------+    .
    .         |                   |                      |              .
    .         |~~~~~~~~deinit()~~>|                      |              .
    .         |                   |~~~~~~~~~~~~~init()~~>|              .
    .         |                   |                      |              .
    .         |                   |<---------------------|              .
    .         |<------------------|                      |              .
    .         |                   |                      |              .
    .      +-----+            +-------+               +-----+           .
    .      | foo |            | thud  |               | bar |           .
    .      +-----+            +-------+               +-----+           .
    .                                                                   .
    .....................................................................

"""
